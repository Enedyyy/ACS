# FinTrack — Архитектурные схемы

---

## 1. Схема функционирования

Общая архитектура системы и взаимодействие компонентов.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         СХЕМА ФУНКЦИОНИРОВАНИЯ                              │
│                         ═══════════════════════                              │
│                                                                              │
│                                                                              │
│      ┌─────────────────┐                    ┌─────────────────┐             │
│      │                 │                    │                 │             │
│      │   COINGECKO     │                    │  EXCHANGERATE   │             │
│      │   API           │                    │  API            │             │
│      │  (Крипто)      │                    │  (Валюты)      │             │
│      │                 │                    │                 │             │
│      └────────┬────────┘                    └────────┬────────┘             │
│               │                                      │                       │
│               │  Цены крипто                       │  Курсы валют        │
│               │                                      │                       │
│               ▼                                      ▼                       │
│      ┌────────────────────────────────────────────────────────┐             │
│      │                                                         │             │
│      │                      S E R V E R                        │             │
│      │                                                         │             │
│      │                   Spring Boot 3.2                       │             │
│      │                     (Java 17)                           │             │
│      │                                                         │             │
│      │    ┌─────────────────────────────────────────────┐     │             │
│      │    │  Controllers │ Services │ Repositories      │     │             │
│      │    └─────────────────────────────────────────────┘     │             │
│      │                                                         │             │
│      └──────────────┬─────────────────────┬───────────────────┘             │
│                     │                     │                                  │
│            HTTP/SSE │                     │ JDBC                            │
│           :8080     │                     │                                  │
│                     ▼                     ▼                                  │
│      ┌──────────────────────┐   ┌──────────────────────┐                    │
│      │                      │   │                      │                    │
│      │      C L I E N T     │   │   BAZA DE DATE       │                    │
│      │                      │   │      LOCALĂ          │                    │
│      │    Vue.js 3 + TS     │   │                      │                    │
│      │    Pinia + Chart.js  │   │   SQLite             │                    │
│      │                      │   │   (fintrack.db)      │                    │
│      │  ┌────────────────┐  │   │                      │                    │
│      │  │  IndexedDB     │  │   │  • users             │                    │
│      │  │  Cache         │  │   │  • transactions      │                    │
│      │  └────────────────┘  │   │  • budgets           │                    │
│      │                      │   │  • reminders         │                    │
│      │  ┌────────────────┐  │   │  • sessions          │                    │
│      │  │  LocalStorage  │  │   │  • groups            │                    │
│      │  │  (настройки)   │  │   │  • group_members     │                    │
│      │  └────────────────┘  │   │                      │                    │
│      │                      │   │                      │                    │
│      └──────────────────────┘   └──────────────────────┘                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Описание компонентов:

| Компонент | Технология | Роль |
|-----------|------------|-----|
| **SERVER** | Spring Boot 3.2, Java 17 | Backend API, бизнес-логика, SSE |
| **CLIENT** | Vue.js 3, TypeScript, Vite | Интерфейс пользователя, графики |
| **БАЗА ДАННЫХ** | SQLite | Постоянное хранение данных |
| **COINGECKO API** | Внешний REST API | Цены криптовалют в реальном времени |
| **EXCHANGERATE API** | Внешний REST API | Курсы валют |
| **IndexedDB** | Хранилище браузера | Кэш ответов API (TTL 5 мин) |
| **LocalStorage** | Хранилище браузера | Настройки пользователя, темы, избранное |

---

## 2. Общая схема алгоритма

Потоки данных и операции между компонентами.

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           ОБЩАЯ СХЕМА АЛГОРИТМА                                  │
│                           ═══════════════════════                                  │
│                                                                                      │
│                                                                                      │
│    ┌─────────┐                                                    ┌─────────────┐   │
│    ┌─────────┐                                                    ┌─────────────┐   │
│    │  SID    │─────────────────────────────┐                      │             │   │
│    │ COOKIE  │                             │                      │  COINGECKO  │   │
│    └─────────┘                             │                      │    API      │   │
│         │                                  │                      └──────┬──────┘   │
│         │ Аутентификация                   │                             │          │
│         ▼                                  ▼                             │          │
│    ┌─────────┐                      ┌─────────────┐              Цены   │          │
│    │         │      ВХОД            │             │              крипто  │          │
│    │         │─────────────────────▶│             │◀─────────────────────┘          │
│    │         │                      │             │                                  │
│    │         │      РЕГИСТРАЦИЯ     │             │              ┌──────────────┐   │
│    │         │─────────────────────▶│             │◀─────────────│ EXCHANGERATE │   │
│    │         │                      │             │  Курсы      │     API      │   │
│    │ КЛИЕНТ  │                      │   СЕРВЕР    │  валют     └──────────────┘   │
│    │         │                      │             │                                  │
│    │  Vue.js │      ЗАПРОС          │ Spring Boot │                                  │
│    │         │─────────────────────▶│             │                                  │
│    │         │  (транзакции,        │             │                                  │
│    │         │   бюджеты, группы)   │             │                                  │
│    │         │                      │             │                                  │
│    │         │◀─────────────────────│             │                                  │
│    │         │      ОТВЕТ          │             │                                  │
│    │         │   (JSON data)        │             │                                  │
│    │         │                      │             │                                  │
│    │         │◀═════════════════════│             │                                  │
│    │         │    SSE EVENTS        │             │                                  │
│    │         │  (tx-added, alert,   │             │                                  │
│    │         │   budget-update,     │             │                                  │
│    │         │   reminder)          │             │                                  │
│    └────┬────┘                      └──────┬──────┘                                  │
│         │                                  │                                          │
│         │                                  │                                          │
│         │ КЭШ                              │ ЧТЕНИЕ/ЗАПИСЬ                           │
│         │                                  │                                          │
│         ▼                                  ▼                                          │
│    ┌─────────────┐                  ┌─────────────────┐                              │
│    │             │                  │                 │                              │
│    │  IndexedDB  │                  │    SQLite       │                              │
│    │  (браузер)  │                  │  БАЗА ДАННЫХ    │                              │
│    │             │                  │                 │                              │
│    │ TTL: 5 min  │                  │ • users         │                              │
│    │             │                  │ • transactions  │                              │
│    └─────────────┘                  │ • budgets       │                              │
│                                     │ • reminders     │                              │
│                                     │ • sessions      │                              │
│                                     │ • groups        │                              │
│                                     │                 │                              │
│                                     └─────────────────┘                              │
│                                                                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### Поток операций:

┌──────────────────────────────────────────────────────────────────────────────┐
│                              ПОТОК АУТЕНТИФИКАЦИИ                            │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│   ┌────────┐    POST /api/register     ┌────────────┐    hash SHA-256        │
│   │ КЛИЕНТ│ ──────────────────────▶│ AuthService│───────────────────┐    │
│   └────────┘    логин + пароль          └────────────┘                   │    │
│                                                                          ▼    │
│   ┌────────┐    POST /api/login        ┌────────────┐    верификация   ┌───┐  │
│   │ КЛИЕНТ │ ─────────────────────────▶│ AuthService│◀────────────────│ DB│  │
│   └────────┘                           └─────┬──────┘                 └───┘  │
│       ▲                                      │                                │
│       │         Set-Cookie: SID=...          │                                │
│       │         {ok: true, user: {...}}      │                                │
│       └──────────────────────────────────────┘                                │
│                                                                               │
│   ┌────────┐    GET /api/events        ┌────────────┐                        │
│   │ CLIENT │ ─────────────────────────▶│ SseService │ ══▶ SSE Connection     │
│   └────────┘    (SSE handshake)        └────────────┘                        │
│                                                                               │
└──────────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────────┐
│                           ПОТОК ТРАНЗАКЦИИ                                   │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│   ┌────────┐   ввод: описание         ┌───────────────────┐                 │
│   │ ФОРМА  │ ─────────────────────────▶│AutoCategorizerSvc │                 │
│   └────────┘   (debounce 300ms)        └─────────┬─────────┘                 │
│       │                                          │                            │
│       │◀─────────────────────────────────────────┘                            │
│       │        предложенная категория                                       │
│       │                                                                       │
│       │        POST /api/transaction/add                                      │
│       └───────────────────────────────────────────────────────┐               │
│                                                               ▼               │
│                                                    ┌───────────────────┐      │
│                                                    │  FinanceService   │      │
│                                                    │                   │      │
│                                                    │  1. Save TX       │      │
│                                                    │  2. Update spent  │      │
│                                                    │  3. Check budget  │      │
│                                                    └─────────┬─────────┘      │
│                                                              │                │
│                                                              ▼                │
│   ┌────────┐         SSE events                   ┌───────────────────┐      │
│   │ КЛИЕНТ │◀═════════════════════════════════════════│   SseService      │      │
│   └────────┘    • tx-added                        │                   │      │
│                 • budget-update                   │  if spent > limit │      │
│                 • alert (если бюджет превышен)   │  → send alert     │      │
│                                                   └───────────────────┘      │
│                                                                               │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Детальная схема сервера

Внутренняя архитектура бэкенда Spring Boot.

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              ДЕТАЛЬНАЯ СХЕМА СЕРВЕРА                                  │
│                              ═══════════════════════                                  │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              SPRING BOOT SERVER                                  │    │
│  │                                                                                  │    │
│  │   ┌─────────────────────────────────────────────────────────────────────────┐   │    │
│  │   │                           CONTROLLERS                                    │   │    │
│  │   │                                                                          │   │    │
│  │   │  ┌──────────────┐  ┌─────────────────┐  ┌──────────────────┐            │   │    │
│  │   │  │    Auth      │  │   Transaction   │  │     Budget       │            │   │    │
│  │   │  │  Controller  │  │   Controller    │  │   Controller     │            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │ /api/login   │  │ /api/transaction│  │ /api/budget      │            │   │    │
│  │   │  │ /api/register│  │ /api/transactions│ │ /api/budget/set  │            │   │    │
│  │   │  │ /api/logout  │  │                 │  │ /api/budget/delete│           │   │    │
│  │   │  │ /api/me      │  │                 │  │                  │            │   │    │
│  │   │  └──────┬───────┘  └────────┬────────┘  └────────┬─────────┘            │   │    │
│  │   │         │                   │                    │                       │   │    │
│  │   │  ┌──────────────┐  ┌─────────────────┐  ┌──────────────────┐            │   │    │
│  │   │  │   Reminder   │  │     Group       │  │    Currency      │            │   │    │
│  │   │  │  Controller  │  │   Controller    │  │   Controller     │            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │/api/reminder │  │ /api/group/*    │  │ /api/currency    │            │   │    │
│  │   │  │/api/reminders│  │   create/join   │  │ /api/currency/   │            │   │    │
│  │   │  │              │  │   leave/me/peers│  │    convert       │            │   │    │
│  │   │  └──────┬───────┘  └────────┬────────┘  └────────┬─────────┘            │   │    │
│  │   │         │                   │                    │                       │   │    │
│  │   │  ┌──────────────┐  ┌─────────────────┐  ┌──────────────────┐            │   │    │
│  │   │  │     SSE      │  │   Categorizer   │  │     Health       │            │   │    │
│  │   │  │  Controller  │  │   Controller    │  │   Controller     │            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │ /api/events  │  │/api/categorizer │  │ /health          │            │   │    │
│  │   │  │              │  │    /suggest     │  │ /health/db       │            │   │    │
│  │   │  └──────┬───────┘  └────────┬────────┘  └──────────────────┘            │   │    │
│  │   │         │                   │                                            │   │    │
│  │   └─────────┼───────────────────┼────────────────────────────────────────────┘   │    │
│  │             │                   │                                                │    │
│  │             ▼                   ▼                                                │    │
│  │   ┌─────────────────────────────────────────────────────────────────────────┐   │    │
│  │   │                            SERVICES                                      │   │    │
│  │   │                                                                          │   │    │
│  │   │  ┌──────────────┐  ┌─────────────────┐  ┌──────────────────┐            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │ AuthService  │  │ FinanceService  │  │  GroupService    │            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │ • register   │  │ • addTransaction│  │ • create         │            │   │    │
│  │   │  │ • login      │  │ • listTx        │  │ • join           │            │   │    │
│  │   │  │ • session    │  │ • deleteTx      │  │ • leave          │            │   │    │
│  │   │  │   management │  │ • setBudget     │  │ • members        │            │   │    │
│  │   │  │              │  │ • reminders     │  │                  │            │   │    │
│  │   │  └──────┬───────┘  └────────┬────────┘  └────────┬─────────┘            │   │    │
│  │   │         │                   │                    │                       │   │    │
│  │   │  ┌──────────────┐  ┌─────────────────┐  ┌──────────────────┐            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  │  SseService  │  │ CurrencyService │  │AutoCategorizer   │            │   │    │
│  │   │  │              │  │                 │  │   Service        │            │   │    │
│  │   │  │ • register   │  │ • getRates      │  │                  │            │   │    │
│  │   │  │ • send       │  │ • convert       │  │ • categorize     │            │   │    │
│  │   │  │ • broadcast  │  │ • cache mgmt    │  │ • keyword rules  │            │   │    │
│  │   │  │              │  │                 │  │                  │            │   │    │
│  │   │  └──────────────┘  └─────────────────┘  └──────────────────┘            │   │    │
│  │   │                                                                          │   │    │
│  │   └─────────────────────────────────────────────────────────────────────────┘   │    │
│  │                                         │                                        │    │
│  │                                         ▼                                        │    │
│  │   ┌─────────────────────────────────────────────────────────────────────────┐   │    │
│  │   │                          REPOSITORIES (JPA)                              │   │    │
│  │   │                                                                          │   │    │
│  │   │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐            │   │    │
│  │   │  │   User     │ │Transaction │ │  Budget    │ │  Reminder  │            │   │    │
│  │   │  │ Repository │ │ Repository │ │ Repository │ │ Repository │            │   │    │
│  │   │  └────────────┘ └────────────┘ └────────────┘ └────────────┘            │   │    │
│  │   │                                                                          │   │    │
│  │   │  ┌────────────┐ ┌────────────┐ ┌────────────┐                           │   │    │
│  │   │  │  Session   │ │   Group    │ │GroupMember │                           │   │    │
│  │   │  │ Repository │ │ Repository │ │ Repository │                           │   │    │
│  │   │  └────────────┘ └────────────┘ └────────────┘                           │   │    │
│  │   │                                                                          │   │    │
│  │   └──────────────────────────────────┬──────────────────────────────────────┘   │    │
│  │                                      │                                          │    │
│  └──────────────────────────────────────┼──────────────────────────────────────────┘    │
│                                         │                                               │
│                                         │ JDBC                                          │
│                                         ▼                                               │
│                            ┌────────────────────────┐                                   │
│                            │                        │                                   │
│                            │     SQLite DATABASE    │                                   │
│                            │     (fintrack.db)      │                                   │
│                            │                        │                                   │
│                            │  ┌──────────────────┐  │                                   │
│                            │  │     TABLES       │  │                                   │
│                            │  ├──────────────────┤  │                                   │
│                            │  │ • users          │  │                                   │
│                            │  │ • transactions   │  │                                   │
│                            │  │ • budgets        │  │                                   │
│                            │  │ • reminders      │  │                                   │
│                            │  │ • sessions       │  │                                   │
│                            │  │ • groups         │  │                                   │
│                            │  │ • group_members  │  │                                   │
│                            │  └──────────────────┘  │                                   │
│                            │                        │                                   │
│                            └────────────────────────┘                                   │
│                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Схема коммуникации Клиент-Сервер

Протоколы и типы запросов.

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           СХЕМА КОММУНИКАЦИИ КЛИЕНТ-СЕРВЕР                          │
│                           ═══════════════════════════════                          │
│                                                                                          │
│                                                                                          │
│     ┌─────────────────────────────┐              ┌─────────────────────────────┐        │
│     │          CLIENT             │              │          SERVER              │        │
│     │         (Vue.js)            │              │       (Spring Boot)          │        │
│     │                             │              │                              │        │
│     │  ┌───────────────────────┐  │              │  ┌───────────────────────┐   │        │
│     │  │    api/client.ts      │  │   HTTP/1.1   │  │     Controllers       │   │        │
│     │  │                       │  │              │  │                       │   │        │
│     │  │  ┌─────────────────┐  │  │              │  │                       │   │        │
│     │  │  │  api() function │──┼──┼──────────────┼──┼──▶ REST API          │   │        │
│     │  │  └─────────────────┘  │  │    JSON      │  │                       │   │        │
│     │  │                       │  │              │  │                       │   │        │
│     │  │  ┌─────────────────┐  │  │              │  │                       │   │        │
│     │  │  │ sseConnect()    │══┼══┼══════════════┼══┼══▶ SSE Endpoint      │   │        │
│     │  │  └─────────────────┘  │  │  keep-alive  │  │    /api/events        │   │        │
│     │  │                       │  │              │  │                       │   │        │
│     │  └───────────────────────┘  │              │  └───────────────────────┘   │        │
│     │                             │              │                              │        │
│     └─────────────────────────────┘              └─────────────────────────────┘        │
│                                                                                          │
│                                                                                          │
│     ══════════════════════════════════════════════════════════════════════════          │
│                              ТИПЫ ЗАПРОСОВ                                              │
│     ══════════════════════════════════════════════════════════════════════════          │
│                                                                                          │
│                                                                                          │
│     ┌──────────────┐         GET запросы (чтение)           ┌──────────────┐           │
│     │              │ ───────────────────────────────────────▶│              │           │
│     │              │  /api/transactions, /api/budget,        │              │           │
│     │              │  /api/reminders, /api/me, etc.          │              │           │
│     │              │                                         │              │           │
│     │              │◀─────────────────────────────────────── │              │           │
│     │              │         JSON Ответ                      │              │           │
│     │              │                                         │              │           │
│     │    КЛИЕНТ   │                                         │    СЕРВЕР   │           │
│     │              │        POST запросы (запись)           │              │           │
│     │              │ ───────────────────────────────────────▶│              │           │
│     │              │  /api/login, /api/transaction/add,      │              │           │
│     │              │  /api/budget/set, etc.                  │              │           │
│     │              │                                         │              │           │
│     │              │◀─────────────────────────────────────── │              │           │
│     │              │         JSON Response                   │              │           │
│     │              │                                         │              │           │
│     │              │                                         │              │           │
│     │              │═══════════════════════════════════════▶ │              │           │
│     │              │         SSE Connection                  │              │           │
│     │              │         GET /api/events                 │              │           │
│     │              │                                         │              │           │
│     │              │◀═══════════════════════════════════════ │              │           │
│     │              │         Server-Sent Events              │              │           │
│     │              │  • tx-added                             │              │           │
│     │              │  • budget-update                        │              │           │
│     │              │  • reminder                             │              │           │
│     │              │  • alert                                │              │           │
│     └──────────────┘                                         └──────────────┘           │
│                                                                                          │
│                                                                                          │
│     ══════════════════════════════════════════════════════════════════════════          │
│                              АУТЕНТИФИКАЦИЯ                                              │
│     ══════════════════════════════════════════════════════════════════════════          │
│                                                                                          │
│                                                                                          │
│     ┌────────────┐                                          ┌────────────┐              │
│     │            │    1. POST /api/login                    │            │              │
│     │            │    ─────────────────────────────────────▶│            │              │
│     │            │    username=... & password=...           │            │              │
│     │            │                                          │            │              │
│     │            │    2. Проверка credentials              │            │              │
│            │                                    ┌─────┤            │              │
│    КЛИЕНТ   │                                    │     │   СЕРВЕР   │              │
│            │    3. Создание сессии               │     │            │              │
│     │            │                                    └────▶│            │              │
│     │            │                                          │            │              │
│     │            │    4. Set-Cookie: SID=abc123...          │            │              │
│     │            │◀───────────────────────────────────────── │            │              │
│     │            │    {ok: true, user: {...}}               │            │              │
│     │            │                                          │            │              │
│     │            │    5. Все запросы включают Cookie        │            │              │
│     │            │    ═════════════════════════════════════▶│            │              │
│     │            │    Cookie: SID=abc123...                 │            │              │
│     └────────────┘                                          └────────────┘              │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Схема кэширования и хранения данных

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          СХЕМА КЭШИРОВАНИЯ И ХРАНЕНИЯ ДАННЫХ                      │
│                          ═════════════════════════════════════                      │
│                                                                                          │
│                                                                                          │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    CLIENT                                        │  │
│    │                                                                                  │  │
│    │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│    │   │                              BROWSER                                     │   │  │
│    │   │                                                                          │   │  │
│    │   │   ┌────────────────────────┐    ┌────────────────────────────────────┐  │   │  │
│    │   │   │      IndexedDB         │    │          LocalStorage              │  │   │  │
│    │   │   │   (fintrack-cache)     │    │                                    │  │   │  │
│    │   │   │                        │    │  ┌──────────────────────────────┐  │  │   │  │
│    │   │   │   ┌────────────────┐   │    │  │  favorites: ["Food","Shop"] │  │  │   │  │
│    │   │   │   │  Cache Entry   │   │    │  │  theme: "dark"              │  │  │   │  │
│    │   │   │   │                │   │    │  │  baseCurrency: "MDL"        │  │  │   │  │
│    │   │   │   │  url: /api/... │   │    │  │  tx.templates: [...]        │  │  │   │  │
│    │   │   │   │  data: {...}   │   │    │  │  rec.options: {...}         │  │  │   │  │
│    │   │   │   │  ts: 170000... │   │    │  │  crypto.latest: [...]       │  │  │   │  │
│    │   │   │   │                │   │    │  └──────────────────────────────┘  │  │   │  │
│    │   │   │   │  TTL: 5 мин    │   │    │                                    │  │   │  │
│    │   │   │   │                │   │    │         (постоянное)               │  │   │  │
│    │   │   │   │  Инвалидация при POST   │    │                                    │  │   │  │
│    │   │   └────────────────────────┘    └────────────────────────────────────┘  │   │  │
│    │   │                                                                          │   │  │
│    │   └──────────────────────────────────────────────────────────────────────────┘   │  │
│    │                                                                                  │  │
│    └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
│                                                                                          │
│    ┌─────────────────────────────────────────────────────────────────────────────────┐  │
│    │                                    SERVER                                        │  │
│    │                                                                                  │  │
│    │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│    │   │                          IN-MEMORY CACHE                                 │   │  │
│    │   │                                                                          │   │  │
│    │   │   ┌───────────────────────┐    ┌───────────────────────────────────┐    │   │  │
│    │   │   │     AuthService       │    │       CurrencyService             │    │   │  │
│    │   │   │                       │    │                                   │    │   │  │
│    │   │   │  userCache:           │    │  cache:                           │    │   │  │
│    │   │   │  ConcurrentHashMap    │    │  CurrencyRates (volatile)         │    │   │  │
│    │   │   │  <username, User> │    │   │   │  TTL: 1 час                        │    │   │  │
│    │   │   │                       │    │                                   │    │   │  │
│    │   │   │  sessionCache:        │    │  histCache:                       │    │   │  │
│    │   │   │  ConcurrentHashMap    │    │  ConcurrentHashMap                │    │   │  │
│    │   │   │  <sid, username>      │    │  <date, rates>                    │    │   │  │
│    │   │   │                │    │   │   │  TTL: 6 часов                     │    │   │  │
│    │   │   └───────────────────────┘    └───────────────────────────────────┘    │   │  │
│    │   │                                                                          │   │  │
│    │   │   ┌───────────────────────────────────────────────────────────────────┐ │   │  │
│    │   │   │                        SseService                                  │ │   │  │
│    │   │   │                                                                    │ │   │  │
│    │   │   │     emitters: ConcurrentHashMap<sessionId, SseEmitter>            │ │   │  │
│    │   │   │                                                                    │ │   │  │
│    │    │   │     Активные SSE соединения                                      │ │   │  │
│    │   │   └───────────────────────────────────────────────────────────────────┘ │   │  │
│    │   │                                                                          │   │  │
│    │   └──────────────────────────────────────────────────────────────────────────┘   │  │
│    │                                                                                  │  │
│    │                                         │                                        │  │
│    │                                         │ JDBC                                   │  │
│    │                                         ▼                                        │  │
│    │   ┌─────────────────────────────────────────────────────────────────────────┐   │  │
│    │   │                           SQLite DATABASE                                │   │  │
│    │   │                          (./data/fintrack.db)                            │   │  │
│    │   │                                                                          │   │  │
│    │   │     ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │  │
│    │   │     │   users     │  │transactions │  │  budgets    │  │  reminders  │  │   │  │
│    │   │     └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │  │
│    │   │                                                                          │   │  │
│    │   │     ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                   │   │  │
│    │   │     │  sessions   │  │   groups    │  │group_members│                   │   │  │
│    │   │     └─────────────┘  └─────────────┘  └─────────────┘                   │   │  │
│    │   │                                                                          │   │  │
│    │   │                        ПОСТОЯННОЕ ХРАНИЛИЩЕ                               │   │  │
│    │   └─────────────────────────────────────────────────────────────────────────┘   │  │
│    │                                                                                  │  │
│    └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Легенда символов

| Символ | Значение |
|--------|----------|
| `───▶` | HTTP запрос |
| `◀───` | HTTP ответ |
| `═══▶` | SSE соединение (постоянное) |
| `│` | Поток данных |
| `┌┐└┘` | Границы компонентов |
| `▼` | Направление потока |
